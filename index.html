<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>분할매수 계산기</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  background:#020617;
  color:#e5e7eb;
  font-family:system-ui;
}
.app{
  max-width:520px;
  margin:auto;
  padding:16px;
}
.card{
  border:1px solid #1f2937;
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}
label{
  font-size:12px;
  color:#9ca3af;
}
input,select,button{
  width:100%;
  padding:8px;
  margin-top:4px;
  border-radius:10px;
  border:1px solid #374151;
  background:#020617;
  color:#e5e7eb;
}
button{
  margin-top:12px;
  background:linear-gradient(135deg,#22c55e,#0ea5e9);
  font-weight:700;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
  font-size:12px;
}
th,td{
  border:1px solid #1f2937;
  padding:6px;
  text-align:right;
}
th:first-child,td:first-child{
  text-align:center;
}
th{
  background:#0b1120;
  color:#9ca3af;
}
</style>
</head>

<body>
<div class="app">

<div class="card">
  <label>기준 매수가</label>
  <input id="inputEntry" type="number" value="90000">

  <label>포지션</label>
  <select id="inputSide">
    <option value="long">롱 (LONG)</option>
    <option value="short">숏 (SHORT)</option>
  </select>

  <label>분할 간격</label>
  <input id="inputInterval" type="number" value="150">

  <label>손절 %</label>
  <input id="inputStop" type="number" value="0.3">

  <label>전체 시드</label>
  <input id="inputTotalSeed" type="number" value="3782">

  <label>거래 시드 비율</label>
  <input id="inputTradeRatio" type="number" value="0.4">

  <label>레버리지</label>
  <input id="inputLeverage" type="number" value="10">

  <label>분할 비중 (합계 1)</label>
  <input id="inputSplit" value="0.2,0.3,0.5">

  <label>익절 % (1,2,3차)</label>
  <input id="inputTp" value="0.7,1.2,1.8">

  <button onclick="calculate()">계산하기</button>
</div>

<div class="card" id="resultBox" style="display:none">
  <div id="summaryText"></div>

  <table id="avgTable"></table>
  <table id="buyTable"></table>
  <table id="sellTable"></table>
</div>

</div>

<script>
function calculate(){

  const entryPrice = Number(document.getElementById("inputEntry").value);
  const side = document.getElementById("inputSide").value;
  const interval = Number(document.getElementById("inputInterval").value);
  const stopPct = Number(document.getElementById("inputStop").value) / 100;
  const totalSeed = Number(document.getElementById("inputTotalSeed").value);
  const tradeRatio = Number(document.getElementById("inputTradeRatio").value);
  const leverage = Number(document.getElementById("inputLeverage").value);

  const split = document.getElementById("inputSplit").value.split(",").map(Number);
  const tpPct = document.getElementById("inputTp").value.split(",").map(v=>Number(v)/100);

  const tradeSeed = totalSeed * tradeRatio;

  const prices = [
    entryPrice,
    side==="long" ? entryPrice-interval : entryPrice+interval,
    side==="long" ? entryPrice-interval*2 : entryPrice+interval*2
  ];

  const margin = split.map(r=>tradeSeed*r);
  const qty = prices.map((p,i)=>(margin[i]*leverage)/p);
  const totalQty = qty.reduce((a,b)=>a+b,0);

  const avgPrice = (tradeSeed*leverage)/totalQty;
  const stopPrice = side==="long"
    ? avgPrice*(1-stopPct)
    : avgPrice*(1+stopPct);

  const tpPrices = tpPct.map(p=>
    side==="long" ? avgPrice*(1+p) : avgPrice*(1-p)
  );

  document.getElementById("summaryText").innerText =
    `거래 시드 ${tradeSeed.toFixed(2)} USDT / 레버리지 x${leverage}
     · 총 수량 ${totalQty.toFixed(6)}`;

  document.getElementById("avgTable").innerHTML = `
    <tr><th>항목</th><th>가격</th></tr>
    <tr><td>평균가</td><td>${avgPrice.toFixed(2)}</td></tr>
    <tr><td>손절가</td><td>${stopPrice.toFixed(2)}</td></tr>
  `;

  document.getElementById("buyTable").innerHTML = `
    <tr><th>차수</th><th>가격</th><th>증거금</th><th>수량</th></tr>
    ${prices.map((p,i)=>`
      <tr>
        <td>${i+1}</td>
        <td>${p.toFixed(2)}</td>
        <td>${margin[i].toFixed(2)}</td>
        <td>${qty[i].toFixed(6)}</td>
      </tr>`).join("")}
  `;

  document.getElementById("sellTable").innerHTML = `
    <tr><th>차수</th><th>익절가</th><th>매도수량</th></tr>
    ${tpPrices.map((p,i)=>`
      <tr>
        <td>${i+1}</td>
        <td>${p.toFixed(2)}</td>
        <td>${(totalQty*[0.3,0.4,0.3][i]).toFixed(6)}</td>
      </tr>`).join("")}
  `;

  document.getElementById("resultBox").style.display="block";
}
</script>

</body>
</html>
