<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>분할매수 계산기</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#111827" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color-scheme: dark;
    }
    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: #020617;
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      justify-content: center;
    }
    .app {
      width: 100%;
      max-width: 480px;
      padding: 16px 16px 24px;
    }

    .title {
      text-align: center;
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .subtitle {
      text-align: center;
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 16px;
    }

    .card {
      background: #020617;
      border-radius: 16px;
      border: 1px solid #1f2937;
      padding: 14px 12px;
      margin-bottom: 14px;
      box-shadow: 0 14px 35px rgba(15,23,42,0.95);
    }

    .field-label {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .field-row {
      display: flex;
      gap: 8px;
    }

    input, button {
      border-radius: 12px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 14px;
      padding: 10px 12px;
      width: 100%;
      outline: none;
    }
    input:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px #0f172a;
    }

    .side-toggle {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      margin-top: 4px;
    }
    .side-btn {
      border-radius: 999px;
      border: 1px solid #374151;
      padding: 8px 0;
      font-size: 13px;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
      user-select: none;
      background: #020617;
    }
    .side-btn.active-long {
      border-color: #22c55e;
      background: radial-gradient(circle at top, #16a34a 0, #052e16 55%, #020617 100%);
      color: #ecfdf5;
    }
    .side-btn.active-short {
      border-color: #f97316;
      background: radial-gradient(circle at top, #f97316 0, #7c2d12 55%, #020617 100%);
      color: #fff7ed;
    }

    .btn-main {
      margin-top: 8px;
      background: linear-gradient(135deg, #22c55e, #0ea5e9);
      border: none;
      font-weight: 700;
      font-size: 15px;
      padding: 12px;
      box-shadow: 0 8px 25px rgba(34,197,94,0.5);
      cursor: pointer;
    }
    .btn-main:active {
      transform: translateY(1px);
      box-shadow: 0 4px 16px rgba(34,197,94,0.5);
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      font-size: 12px;
    }
    .result-item {
      border-radius: 12px;
      border: 1px solid #1f2937;
      background: #020617;
      padding: 8px;
    }
    .result-label {
      color: #9ca3af;
      font-size: 11px;
      margin-bottom: 4px;
    }
    .result-value {
      font-size: 15px;
      font-weight: 700;
    }
    .result-row-wide {
      grid-column: span 2;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      color: #9ca3af;
      margin-bottom: 6px;
    }
    .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #22c55e;
    }
    .dot-red {
      background: #f97316;
    }

    .small {
      font-size: 10px;
      color: #6b7280;
      margin-top: 6px;
    }

  </style>
</head>
<body>
  <div class="app">
    <div class="title">분할매수 계산기</div>
    <div class="subtitle">희망가 · 방향 · 퍼센트만 넣고 한 번에 보기</div>

    <!-- 입력 카드 -->
    <div class="card">
      <div class="badge"><span class="dot"></span>기본 설정</div>

      <div class="field-label">희망 매수가</div>
      <input id="entryPrice" type="number" step="0.01" inputmode="decimal" placeholder="예: 89507" />

      <div class="field-label" style="margin-top:10px;">매수 방향</div>
      <div class="side-toggle">
        <div id="btnLong" class="side-btn active-long" onclick="setSide('long')">롱 (Long)</div>
        <div id="btnShort" class="side-btn" onclick="setSide('short')">숏 (Short)</div>
      </div>

      <div class="field-row" style="margin-top:10px;">
        <div style="flex:1;">
          <div class="field-label">분할 간격 (USDT)</div>
<input id="intervalPct" type="number" step="0.01" inputmode="decimal" placeholder="예: 150" />
        </div>
        <div style="flex:1;">
          <div class="field-label">손절 (%)</div>
          <input id="stopPct" type="number" step="0.01" inputmode="decimal" placeholder="예: 0.3" />
        </div>
      </div>

      <div class="field-row" style="margin-top:10px;">
        <div style="flex:1;">
          <div class="field-label">1차 익절 (%)</div>
          <input id="tp1Pct" type="number" step="0.01" inputmode="decimal" placeholder="예: 1.0" />
        </div>
        <div style="flex:1;">
          <div class="field-label">2차 익절 (%) (선택)</div>
          <input id="tp2Pct" type="number" step="0.01" inputmode="decimal" placeholder="-" />
        </div>
      </div>

      <div class="field-row" style="margin-top:10px;">
        <div style="flex:1;">
          <div class="field-label">3차 익절 (%) (선택)</div>
          <input id="tp3Pct" type="number" step="0.01" inputmode="decimal" placeholder="-" />
        </div>
        <div style="flex:1; display:flex; align-items:flex-end;">
          <button class="btn-main" onclick="calculate()">계산하기</button>
        </div>
      </div>

      <div class="small">* 희망가 / 분할 / 손절 / 1차 익절은 필수 입력</div>
    </div>

    <!-- 결과 카드 -->
    <div class="card" id="resultCard" style="display:none;">
      <div class="badge">
        <span class="dot-red"></span>
        결과
      </div>
      <div class="result-grid" id="resultGrid"></div>
    </div>
  </div>

  <script>
    let side = "long";

    function setSide(s) {
      side = s;
      const btnLong = document.getElementById("btnLong");
      const btnShort = document.getElementById("btnShort");
      if (s === "long") {
        btnLong.classList.add("active-long");
        btnShort.classList.remove("active-short");
      } else {
        btnShort.classList.add("active-short");
        btnLong.classList.remove("active-long");
      }
    }

    function fmt(x) {
      if (isNaN(x)) return "-";
      return x.toFixed(2);
    }

    function calculate() {
      const entry = parseFloat(document.getElementById("entryPrice").value);
      const intervalPct = parseFloat(document.getElementById("intervalPct").value);
      const stopPct = parseFloat(document.getElementById("stopPct").value);
      const tp1Pct = parseFloat(document.getElementById("tp1Pct").value);
      const tp2Pct = parseFloat(document.getElementById("tp2Pct").value);
      const tp3Pct = parseFloat(document.getElementById("tp3Pct").value);

      if (isNaN(entry) || isNaN(intervalPct) || isNaN(stopPct) || isNaN(tp1Pct)) {
        alert("희망 매수가, 분할 간격, 손절, 1차 익절은 반드시 입력해야 합니다.");
        return;
      }

      // 분할 간격을 퍼센트가 아니라 "가격(USDT) 간격"으로 사용
      function buyPrice(n) {
        if (side === "long") {
          // 롱: 아래로 내려가며 분할 매수
          return entry - (n - 1) * intervalPct;
        } else {
          // 숏: 위로 올라가며 분할 매도
          return entry + (n - 1) * intervalPct;
        }
      }

      const p1 = buyPrice(1);
      const p2 = buyPrice(2);
      const p3 = buyPrice(3);

      let stopPrice;
      if (side === "long") {
        stopPrice = entry * (1 - stopPct / 100);
      } else {
        stopPrice = entry * (1 + stopPct / 100);
      }

      function tp(pct) {
        if (side === "long") {
          return entry * (1 + pct / 100);
        } else {
          return entry * (1 - pct / 100);
        }
      }

      const tp1 = tp(tp1Pct);
      const tp2 = isNaN(tp2Pct) ? null : tp(tp2Pct);
      const tp3 = isNaN(tp3Pct) ? null : tp(tp3Pct);

      let html = "";
      html += `
        <div class="result-item">
          <div class="result-label">1차 매수가</div>
          <div class="result-value">${fmt(p1)}</div>
        </div>
        <div class="result-item">
          <div class="result-label">2차 매수가</div>
          <div class="result-value">${fmt(p2)}</div>
        </div>
        <div class="result-item">
          <div class="result-label">3차 매수가</div>
          <div class="result-value">${fmt(p3)}</div>
        </div>
        <div class="result-item">
          <div class="result-label">손절가</div>
          <div class="result-value">${fmt(stopPrice)}</div>
        </div>
        <div class="result-item result-row-wide">
          <div class="result-label">1차 익절가</div>
          <div class="result-value">${fmt(tp1)}</div>
        </div>
      `;
      if (tp2 !== null) {
        html += `
          <div class="result-item">
            <div class="result-label">2차 익절가</div>
            <div class="result-value">${fmt(tp2)}</div>
          </div>
        `;
      }
      if (tp3 !== null) {
        html += `
          <div class="result-item">
            <div class="result-label">3차 익절가</div>
            <div class="result-value">${fmt(tp3)}</div>
          </div>
        `;
      }

      document.getElementById("resultGrid").innerHTML = html;
      document.getElementById("resultCard").style.display = "block";
    }
  </script>
</body>
</html>
