<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>분할매수 계산기</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin:0;
  background:#020617;
  color:#e5e7eb;
  font-family:system-ui;
}
.app {
  max-width:520px;
  margin:auto;
  padding:16px;
}
.card {
  border:1px solid #1f2937;
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}
input, button {
  width:100%;
  padding:8px;
  border-radius:10px;
  border:1px solid #374151;
  background:#020617;
  color:#e5e7eb;
}
button {
  margin-top:10px;
  background:linear-gradient(135deg,#22c55e,#0ea5e9);
  font-weight:700;
}
.field { margin-bottom:10px; }
label { font-size:12px; color:#9ca3af; }

table {
  width:100%;
  border-collapse:collapse;
  font-size:12px;
  margin-top:8px;
}
th, td {
  border:1px solid #1f2937;
  padding:6px;
  text-align:right;
}
th:first-child, td:first-child {
  text-align:center;
}
th {
  background:#0b1120;
  color:#9ca3af;
}
</style>
</head>

<body>
<div class="app">

<div class="card">
  <div class="field">
    <label>희망 기준 매수가 (USDT)</label>
    <input id="entry" type="number" value="90000">
  </div>

  <div class="field">
    <label>포지션</label>
    <select id="side">
      <option value="long">롱 (LONG)</option>
      <option value="short">숏 (SHORT)</option>
    </select>
  </div>

  <div class="field">
    <label>분할 간격 (USDT)</label>
    <input id="interval" type="number" value="150">
  </div>

  <div class="field">
    <label>손절 %</label>
    <input id="stopPct" type="number" value="0.3">
  </div>

  <div class="field">
    <label>전체 시드 (USDT)</label>
    <input id="totalSeed" type="number" value="3782">
  </div>

  <div class="field">
    <label>이번 거래 시드 비율</label>
    <input id="tradeRatio" type="number" value="0.4">
  </div>

  <div class="field">
    <label>레버리지</label>
    <input id="leverage" type="number" value="10">
  </div>

  <div class="field">
    <label>분할 비중 (합계 1)</label>
    <input id="splitRatio" value="0.2,0.3,0.5">
  </div>

  <div class="field">
    <label>익절 % (1,2,3차)</label>
    <input id="tpPct" value="0.7,1.2,1.8">
  </div>

  <button onclick="calc()">계산하기</button>
</div>

<div class="card" id="result" style="display:none">
  <div id="summary"></div>

  <table id="avgTable"></table>
  <table id="buyTable"></table>
  <table id="sellTable"></table>
</div>

</div>

<script>
function calc() {

  const entry = +entry.value;
  const interval = +interval.value;
  const stopPct = +stopPct.value / 100;
  const totalSeed = +totalSeed.value;
  const tradeRatio = +tradeRatio.value;
  const leverage = +leverage.value;
  const sideVal = side.value;

  const split = splitRatio.value.split(",").map(Number);
  const tpPctArr = tpPct.value.split(",").map(v => +v / 100);

  const tradeSeed = totalSeed * tradeRatio;

  const prices = [
    entry,
    sideVal === "long" ? entry - interval : entry + interval,
    sideVal === "long" ? entry - interval*2 : entry + interval*2
  ];

  const margin = split.map(r => tradeSeed * r);
  const qty = prices.map((p,i)=> (margin[i]*leverage)/p);
  const totalQty = qty.reduce((a,b)=>a+b,0);

  const avgPrice = (tradeSeed * leverage) / totalQty;

  const stopPrice = sideVal === "long"
    ? avgPrice * (1 - stopPct)
    : avgPrice * (1 + stopPct);

  const tpPrices = tpPctArr.map(p =>
    sideVal === "long"
      ? avgPrice * (1 + p)
      : avgPrice * (1 - p)
  );

  document.getElementById("summary").innerText =
    `거래 시드 ${tradeSeed.toFixed(2)} USDT / 레버리지 x${leverage}
     · 총 수량 ${totalQty.toFixed(6)} BTC`;

  avgTable.innerHTML = `
    <tr><th>항목</th><th>가격</th></tr>
    <tr><td>평균가</td><td>${avgPrice.toFixed(2)}</td></tr>
    <tr><td>손절가</td><td>${stopPrice.toFixed(2)}</td></tr>
  `;

  buyTable.innerHTML = `
    <tr><th>차수</th><th>가격</th><th>증거금</th><th>수량</th></tr>
    ${prices.map((p,i)=>`
      <tr>
        <td>${i+1}</td>
        <td>${p.toFixed(2)}</td>
        <td>${margin[i].toFixed(2)}</td>
        <td>${qty[i].toFixed(6)}</td>
      </tr>`).join("")}
  `;

  sellTable.innerHTML = `
    <tr><th>차수</th><th>익절가</th><th>매도수량</th></tr>
    ${tpPrices.map((p,i)=>`
      <tr>
        <td>${i+1}</td>
        <td>${p.toFixed(2)}</td>
        <td>${(totalQty*[0.3,0.4,0.3][i]).toFixed(6)}</td>
      </tr>`).join("")}
  `;

  result.style.display = "block";
}
</script>

</body>
</html>
